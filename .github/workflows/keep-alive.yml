name: Keep App Alive

on:
  schedule:
    # Run every 12 hours to prevent Streamlit Cloud from sleeping
    - cron: '0 */6 * * *'
  workflow_dispatch:  # Allow manual triggering

jobs:
  wake-up:
    runs-on: ubuntu-latest

    steps:
      - name: Wake up Streamlit app
        run: |
          echo "üîÑ Waking up Streamlit Cloud app..."

          # Replace with your actual Streamlit app URL
          APP_URL="https://olist-analytics-platform.streamlit.app"

          # First request - wake up the app
          curl -sSf --max-time 120 \
            -H "User-Agent: GitHub-Actions-KeepAlive" \
            -o /dev/null \
            "$APP_URL" || echo "Initial wake-up request sent"

          # Wait for app to spin up
          echo "‚è≥ Waiting 30 seconds for app to initialize..."
          sleep 30

          # Verify app is responding
          echo "‚úÖ Verifying app is awake..."
          curl -sSf --max-time 60 \
            -H "User-Agent: GitHub-Actions-KeepAlive" \
            -o /dev/null \
            "$APP_URL" && echo "‚úÖ App is awake!" || echo "‚ö†Ô∏è App may still be warming up"

          echo "üéâ Keep-alive completed at $(date -u)"
